<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team | Maneiro.ai</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6f8ff;
      --panel: #ffffff;
      --panel2: #f3f6ff;
      --text: #0b1226;
      --muted: #51565b;
      --border: #d8def0;
      --primary: #9cd0c5;
      --error: #dc2626;
      --success: #16a34a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Source Sans 3", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    .topBar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 26px;
      border-bottom: 1px solid var(--border);
      background: var(--panel);
    }
    .brandLogo { height: 40px; width: auto; }
    .topActions { display: flex; gap: 10px; align-items: center; }
    .iconBtn {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--panel2);
      color: var(--text);
      text-decoration: none;
      font-size: 14px;
      font-weight: 700;
    }
    .iconBtn:hover { background: var(--panel); }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 900;
    }
    .subtitle {
      color: var(--muted);
      margin-bottom: 32px;
    }
    
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .cardTitle {
      font-size: 18px;
      font-weight: 900;
      margin: 0 0 20px 0;
    }
    
    .formGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .formGroup {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .formGroup.full {
      grid-column: 1 / -1;
    }
    .formLabel {
      font-weight: 700;
      font-size: 14px;
      color: var(--muted);
    }
    .formInput, .formSelect {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--panel2);
      font-size: 16px;
      color: var(--text);
    }
    .formInput:focus, .formSelect:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(156,208,197,0.3);
    }
    
    .btnPrimary {
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(180deg, rgba(156,208,197,1), rgba(118,185,173,1));
      color: white;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
    }
    .btnPrimary:hover {
      filter: brightness(1.05);
    }
    .btnDanger {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--error);
      background: transparent;
      color: var(--error);
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
    }
    .btnDanger:hover {
      background: var(--error);
      color: white;
    }
    
    .userList {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .userRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: var(--panel2);
      border-radius: 12px;
    }
    .userInfo {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .userName {
      font-weight: 700;
      font-size: 16px;
    }
    .userMeta {
      color: var(--muted);
      font-size: 14px;
    }
    .userRole {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .userRole.admin {
      background: rgba(156,208,197,0.2);
      color: #0d7a69;
    }
    .userRole.doctor {
      background: rgba(59,130,246,0.15);
      color: #1d4ed8;
    }
    .userRole.staff {
      background: rgba(168,85,247,0.15);
      color: #7c3aed;
    }
    
    .flash {
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .flash.error {
      background: rgba(220,38,38,0.1);
      border: 1px solid rgba(220,38,38,0.3);
      color: var(--error);
    }
    .flash.success {
      background: rgba(22,163,74,0.1);
      border: 1px solid rgba(22,163,74,0.3);
      color: var(--success);
    }
    
    @media (max-width: 600px) {
      .formGrid { grid-template-columns: 1fr; }
      .userRow { flex-direction: column; align-items: flex-start; gap: 12px; }
    }
  </style>
</head>
<body>
  <header class="topBar">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="maneiro" class="brandLogo" />
    </div>
    <div class="topActions">
      <a class="iconBtn" href="{{ url_for('auth.index') }}">Back to App</a>
      <a class="iconBtn" href="{{ url_for('auth.account') }}">Account</a>
      <a class="iconBtn" href="{{ url_for('auth.logout') }}">Logout</a>
    </div>
  </header>

  <div class="container">
    <h1>Team Management</h1>
    <p class="subtitle">{{ org.name }} Â· Add doctors and staff to your clinic</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card">
      <h2 class="cardTitle">Add Team Member</h2>
      <form method="POST" action="{{ url_for('auth.team') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <input type="hidden" name="action" value="add" />
        <div class="formGrid">
          <div class="formGroup">
            <label class="formLabel" for="first_name">First Name</label>
            <input type="text" id="first_name" name="first_name" class="formInput" required />
          </div>
          <div class="formGroup">
            <label class="formLabel" for="last_name">Last Name</label>
            <input type="text" id="last_name" name="last_name" class="formInput" required />
          </div>
          <div class="formGroup">
            <label class="formLabel" for="username">Username</label>
            <input type="text" id="username" name="username" class="formInput" required pattern="[a-zA-Z0-9_]+" placeholder="e.g. jsmith" />
            <small style="color: var(--muted);">Letters, numbers, underscore only. Used for login.</small>
          </div>
          <div class="formGroup">
            <label class="formLabel" for="role">Role</label>
            <select id="role" name="role" class="formSelect">
              <option value="doctor">Doctor (clinical notes, referrals)</option>
              <option value="staff">Staff (triage, patient letters)</option>
            </select>
          </div>
          <div class="formGroup full">
            <label class="formLabel" for="password">Temporary Password</label>
            <input type="password" id="password" name="password" class="formInput" minlength="8" required />
            <small style="color: var(--muted);">At least 8 characters. User can change later.</small>
          </div>
          <div class="formGroup full">
            <button type="submit" class="btnPrimary">Add Team Member</button>
          </div>
        </div>
      </form>
    </div>

    <div class="card">
      <h2 class="cardTitle">Current Team ({{ users|length }})</h2>
      <div class="userList">
        {% for u in users %}
        <div class="userRow">
          <div class="userInfo">
            <div class="userName">{{ u.first_name }} {{ u.last_name }}</div>
            <div class="userMeta">
              @{{ u.username }}
              <span class="userRole {{ u.role.value }}">{{ u.role.value }}</span>
            </div>
          </div>
          {% if u.id != user.id %}
          <form method="POST" action="{{ url_for('auth.team') }}" style="margin: 0;" onsubmit="return confirm('Remove {{ u.first_name }} {{ u.last_name }}?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="action" value="delete" />
            <input type="hidden" name="user_id" value="{{ u.id }}" />
            <button type="submit" class="btnDanger">Remove</button>
          </form>
          {% else %}
          <span style="color: var(--muted); font-size: 13px;">You</span>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</body>
</html>
